class ImageGallery extends HTMLElement {
    constructor() {
        super();
        this.attachShadow({ mode: 'open' });

        this.style.display = "block";
       // this.style.width = "16%"; // Fixed width to 18% of the screen width
        this.style.height = "400px";
        this.style.position = "relative";
        this.style.overflow = "hidden";

        this.container = document.createElement('div');
        this.container.style.display = 'inline-block';
        this.container.style.whiteSpace = 'nowrap';
        this.container.style.height = '100%';
        this.container.style.width = '100%';

        const style = document.createElement('style');
        style.textContent = `
            div {
                display: inline-block;
                white-space: nowrap;
                height: 100%;
                overflow: hidden;
            }
            img {
                height: 100%;
                vertical-align: top;
            }
            .arrow {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                background-color: rgba(0, 0, 0, 0.5);
                color: white;
                border: none;
                padding: 10px;
                cursor: pointer;
                z-index: 10;
            }
            .left-arrow {
                left: 0;
            }
            .right-arrow {
                right: 0;
            }
        `;

        this.shadowRoot.appendChild(style);
        this.shadowRoot.appendChild(this.container);

        this.leftArrow = document.createElement('button');
        this.leftArrow.className = 'arrow left-arrow';
        this.leftArrow.textContent = '◄';
        this.leftArrow.addEventListener('click', () => this.moveLeft());

        this.rightArrow = document.createElement('button');
        this.rightArrow.className = 'arrow right-arrow';
        this.rightArrow.textContent = '►';
        this.rightArrow.addEventListener('click', () => this.moveRight());

        this.shadowRoot.appendChild(this.leftArrow);
        this.shadowRoot.appendChild(this.rightArrow);

        this.scrollSpeed = 1;
        this.scrollMagnitude = 2; // Default magnitude
        this.scrollFrequency = 25; // Default frequency (1 second)
        this.images = [];
        this.scrollInterval = null;
        this.scrollDirection = 1; // 1 for right, -1 for left
    }

    static get observedAttributes() {
        return ['images'];
    }

    attributeChangedCallback(name, oldValue, newValue) {
        if (name === 'images') {
            this.images = JSON.parse(newValue);
            this.updateGallery();
        }
    }

    connectedCallback() {
        this.updateGallery();
        this.startScrolling();
    }

    disconnectedCallback() {
        this.stopScrolling();
    }

    updateGallery() {
        this.container.innerHTML = '';
        if (this.images.length === 0) return;

        // create images 
        const fragment = document.createDocumentFragment();
        this.images.forEach(url => {
            const img = document.createElement('img');
            img.src = url;
            fragment.appendChild(img);
        });

        this.container.appendChild(fragment);
    }

    startScrolling() {
        if (this.scrollInterval) {
            clearInterval(this.scrollInterval);
        }
        this.scrollInterval = setInterval(() => this.scrollImages(), this.scrollFrequency);
    }

    stopScrolling() {
        if (this.scrollInterval) {
            clearInterval(this.scrollInterval);
        }
    }

    scrollImages() {
        const firstImage = this.container.querySelector('img');
        const firstImageWidth = firstImage.clientWidth;

        this.container.scrollLeft += this.scrollMagnitude * this.scrollDirection;

        if (this.container.scrollLeft >= firstImageWidth || this.container.scrollLeft <= -firstImageWidth) {
            firstImage.remove();
            this.container.appendChild(firstImage);
            this.container.scrollLeft = 0;
        }
    }

    moveLeft() {
        const lastImage = this.container.querySelector('img:last-child');
        lastImage.remove();
        this.container.insertBefore(lastImage, this.container.firstChild);
        setTimeout(() => this.startScrolling(), 1000);
    }

    moveRight() {
        const firstImage = this.container.querySelector('img');
        firstImage.remove();
        this.container.appendChild(firstImage);
        this.container.scrollLeft = 0;
        setTimeout(() => this.startScrolling(), 1000);
    }

    setScrollSpeed(magnitude, frequency) {
        this.scrollMagnitude = magnitude;
        this.scrollFrequency = frequency;
        this.startScrolling();
    }
}

customElements.define('image-gallery', ImageGallery);

//const gallery = document.querySelector('image-gallery');

/*gallery.setAttribute('images', JSON.stringify([
    "https://static.wixstatic.com/media/4d52c3_1b938e64c9b6404b97cb14ada49bb07c~mv2.jpg",
    "https://static.wixstatic.com/media/4d52c3_549822eb1293493abb55858050df9807~mv2.jpg",
    "https://static.wixstatic.com/media/4d52c3_292c7fa42553460eb4e289e24c6c278d~mv2.jpg",
    "https://static.wixstatic.com/media/4d52c3_ff08b197156c461a9280ff66d74b0541~mv2.png",
    "https://static.wixstatic.com/media/4d52c3_d770b283e91744e1b51b71dfde4b08ef~mv2.jpg"
]));*/

//gallery.setScrollSpeed(2, 25); // Move 2px every 25ms
